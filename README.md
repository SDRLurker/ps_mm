# Puzzle Strike for MSN Messenger(MSN 메신저 숫자야구)

## 1. 프로젝트 목적

공개된 MSN 메신저 프로토콜을 이용해 게임 등의 기능을 즐길 수 있도록 하는 봇 프로그램을 제작한다. MSN 메신저를 통해 봇 프로그램 계정을 친구 등록을 하고 대화요청을 하장면 봇 프로그램이 사용자가 요청하는 기능을 수행할 수 있도록 한다.

## 2. 구현상의 특징

MSN 메신저 프로토콜을 사용하는 서버들에 접속하여 대화명을 변경할 수 있고 자동으로 친구 추가한 클라이언트들을 등록(허용)할 수 있다. 자바의 awt를 이용하여 그래픽 및 메신저 상태 변경을 할 수 있도록 구현하였다. 

### 2-1. 클래스의 기능

|클래스|작동기능|
|-|-|
|ps.java|UI를 구현. login 클래스와 함께 대화명 및 상태 변경, 로그인할 수 있도록 한다.|
|login.java|MSN 메신저 DS(Dispatch Server)와 NS(Notification Server)에 접속하여 자동으로 사용자(클라이언트)의 친구 추가를 허용한다. 사용자가 대화 요청을 했을 때 chat쓰레드가 생성된다.|
|chat.java|login클래스를 통해 SS(Switchboard Server)에 접속하여 사용자의 대화요청에 따라 여러 가지 기능을 수행한다.|
|md5code.java|MSNP7에서 NS에 접속할 때 비밀번호와 challenge key를 md5암호화 형태로 변환하여 전송해 주어야 인증에 성공한다. 그 때 필요한 파일. 내가 작성한 코드가 아니다.|

## 3. 사용방법

### 3.1. 일반 MSN 메신저 사용자

① 위는 일반 사용자가 로그인 한 화면이다. 

② ‘대화 상대 추가’를 통해 ‘ps-gem@hanmail.net’ 아이디를 추가한다.

③ 만약, 현재 봇 프로그램이 작동 중이라면 위처럼 온라인 상태가 보일 것이다.

④ 대화 요청을 하면 봇 프로그램의 위와 같이 대답을 한다. 즉, 사람이 대답하는 것이 아니라 프로그램이 대화 요청에 답변을 한다.

### 3.2. 봇 프로그램 사용방법
① 봇 프로그램을 실행한다. 윈도우 콘솔 창에서 ‘java ps'라고 입력한다.
② 봇으로 사용할 MSN messenger 계정을 사용하여 아이디와 비밀번호를 다음과 같이 입력한다.
③ 커서가 비밀번호 TextField에 있다면 엔터키를 누르거나 ‘연결’ 버튼을 클릭하면 MSN메신저 로그인을 수행한다.
④ 로그인에 성공했다면 다음과 같이 상황이 뜨며 대화명도 나타난다.
⑤ 봇 프로그램은 로그인 되며 친구요청 및 대화요청을 자동으로 받아들인다. 상태변경 및 대화명도 바꿀 수 있다. ‘끊기’를 누르면 ‘로그아웃’ 된다.

## 4. 주의사항

1. 일반 메신저 사용자가 봤을 때 봇 프로그램이 오프라인으로 보일 때

① 봇 프로그램에서 ‘끊기’ 버튼을 누르고 ‘연결’버튼을 누른다.
이 과정이 안 되면

② 봇 프로그램을 닫고 처음부터 봇 프로그램을 다시 시작한다. 

2. 봇 프로그램에서 ‘로그인을 시도합니다...’라는 메시지만 계속 나타나고 그 뒤로 오랫동안(3~4분 이상) ‘로그인에 성공하였습니다...’라는 메시지가 나타나지 않을 때
봇 프로그램을 닫고 처음부터 봇 프로그램을 다시 시작한다.

## 5. 숫자야구
### 5.1. 숫자야구 게임 규칙(사전지식)
 우선 찾아야 할 세 자리의 숫자가 있다. 그 숫자를 3 Out, Ball, Strike라는 정보를 통해 찾는 게임이다. 
 만약, 찾아야 할 숫자가 123이라고 가정을 한다면 내가 그 숫자를 맞추기 위해 456이라고 대답을 했다면 3 Out(쓰리 아웃)이 된다. 즉, 찾아야 할 숫자와 대답한 숫자에 대해 배치된 자리와 숫자에 대해 완전히 다를 때 이러한 조건이 성립한다. 345라고 대답을 했다면 1 Ball(원 볼)이 된다. 볼은 찾아야 할 세 자리 숫자에 대해 배치된 자리는 다르고 숫자가 같을 경우를 뜻한다. 한 자리(숫자)가 다르면 원 볼, 두 자리가 다르면 투 볼, 세 자리가 다르면 쓰리 볼이 된다. 423이라고 대답을 했다면 2 Strikes(투 스트라이크)가 된다. 스트라이크 찾아야 할 세 자리 숫자에 대해 배치된 자리와 숫자가 같을 경우를 뜻한다. 한 자리만 같으면 원 스트라이크, 두 자리가 같으면 투 스트라이크가 됩니다. 123이라 대답을 했다면 쓰리 스트라이크(삼진)가 된다. 세 자리 숫자가 모두 같기 때문이다.
 찾아야 할 숫자는 0이 들어가서는 안 되며 같은 숫자를 두 번 사용 할 수 없다.
예)121,232,012... 

### 5.2. Puzzle Strike 게임 규칙
1. /문 : 문제를 만든다.
예)

2. /문 (번호) : 클라이언트가 문제를 만든다.
SS(SwitchBoard Server)에 한 명의 사용자(클라이언트)만 있을 때만 사용 가능하다.
이 명령어를 성공적으로 사용했다면 다른 사용자를 초대하여 숫자를 맞추게 할 수 있다.
예)

안되는 예)


3. /답 (번호) : 문제의 정답을 입력하기 위해 답변을 하기 위해 사용한다...
문제가 만들어 진 상태에서만 사용이 가능하다. 문제를 낸 사용자는 답을 입력해도 무효화된다. 
예)

문제가 만들어지지 않았을 경우)

문제를 낸 사람이 이 명령어를 사용할 경우)


### 5.3. 대화명 변경
봇 프로그램에 ‘대화명 변경’이 있고 그 오른쪽에 Textfield가 있다. 그 곳에 봇 프로그램이 사용하게 될 메신저 내의 대화명을 입력한다. 그리고 ‘엔터’키를 누르거나 ‘바꾸기’버튼을 클릭하면 MSN messenger 상에서 대화명이 바뀐다. 다음과 같이 확인이 가능하다.

대화명 오른쪽 Textfield에 커서를 놓고 엔터를 누르면 MSN messenger 상에서 다음과 같이 대화명이 바뀌었음을 확인할 수 있다.

주의) 대화명은 한글과 일어, 아스키 코드만 사용이 가능하다.
또한 대화명이 ‘확인되지 않은 E-mail주소’라고 대화명이 되어 있을 경우 대화명 변경이 불가능하다.

## 6. Discussion
 이 프로그램은 MSN 메신저 프로토콜을 이용한 봇 프로그램이다. MSN 메신저 사용자의 친구 추가 요청을 받아들일 수 있으며 대화 요청을 할 때 응답을 할 수 있도록 제작하였다.   '동우의 사전'이라는 MSN 메신저 봇 프로그램이었다. 영어 단어를 입력하면 한글로 그 뜻을 답변해 주는 기능이 있다. 또한, ASP 언어로 숫자야구 게임을 제작한 적이 있는 데 메신저로 대화하면서 할 수도 있지 않을까 하는 말을 들었다. 이러한 이유로 이 프로그램을 만들게 되었다.
 이 봇 프로그램의 중요한 요소 중 하나는 쓰레드다. 봇 프로그램의 UI에 해당하는 ps 클래스는 login 객체를 생성한다. login 객체는 쓰레드를 상속받았다. 이 쓰레드는 MSN 메신저 서비스에서 DS(Dispatch Server)에 접속해서 NS(Notification Server)에 접속한다. NS서버에 상태 변경 및 대화명 변경 할 수 있는 프로토콜 신호를 보낼 수 있다. 또한, 사용자가 봇 계정을 추가했을 때는 자동으로 그 사용자를 대화 가능하도록 허용한다. 사용자가 대화요청을 하면 login 객체는 chat 객체를 생성한다. chat 객체 역시 쓰레드를 상속 받았다. chat 객체는 위에서 설명한 숫자야구 게임을 MSN 메신저 상에서 사용자와 대화를 통해 가능하도록 한다.
 이 프로그램 뿐 만이 아니라 네이트온 등의 메신저가 MSN 메신저와 연동되는 서비스를 하고 있었다. 무료로 공개된 프로토콜을 통해 여러 가지 부가적인 서비스를 제공할 수 있다는 것이 MSN 메신저의 장점이었다. 하지만 이 프로토콜은 성인 사이트 등의 광고 등의 나쁜 목적으로 사용될 수도 있는 단점 때문에 라이센스 비용을 요구하게 되었다. 
 MSN 메신저를 사용하면서 군대 간 사람들의 계정들이 지워지는 것을 보았다. 또한, MSN 메신저와 연동되는 서비스를 할 수 없었던 네이트온 메신저가 후에 싸이월드와 연동되면서 새로운 형태의 서비스를 제공했다는 점에서 더 좋은 메신저가 되는 데 도움이 되었다고 생각한다. 이러한 단점 때문에 네이트온이 한국에서 더 많이 사용하는 메신저가 되지 않았을까 하고 생각한다. 
 
## 7. Reference
* http://www.venkydude.com/articles/msn.htm
  - MSNP7에 대한 프로토콜에 대해 자세히 설명 되어 있다.
* http://www.hypothetic.org/docs/msn/ietf_draft.php
  - MSN messenger Service 1.0에 대한 공식 문서다.




